---
import { property, getPrimaryContact } from "../data/property";
import { cloudinaryVideo, cloudinaryUrl } from "../lib/cloudinary";
import ContactSectionAnimated from "./ContactSectionAnimated";

interface Props {
  videoId?: string;
  posterImageId?: string;
}

const { videoId = "skiing-trees-video", posterImageId = property.images.hero } =
  Astro.props;

const primaryContact = getPrimaryContact();
const videoUrl = cloudinaryVideo(videoId, "q_auto");
const posterUrl = cloudinaryUrl(posterImageId, "w_1920,q_auto,f_auto");
---

<section
  id="contact"
  class="relative scroll-mt-8 overflow-hidden py-16 sm:py-24"
>
  <video
    id="contact-video"
    autoplay
    muted
    loop
    playsinline
    disablepictureinpicture
    poster={posterUrl}
    class="contact-video absolute inset-0 h-full w-full object-cover"
  >
    <source src={`${videoUrl}.webm`} type="video/webm" />
    <source src={`${videoUrl}.mp4`} type="video/mp4" />
    <img
      src={posterUrl}
      alt="Skiing through trees"
      class="absolute inset-0 h-full w-full object-cover"
    />
  </video>

  <div class="absolute inset-0 bg-black/60"></div>

  <ContactSectionAnimated
    client:visible
    propertyName={property.name}
    primaryContact={primaryContact}
  />
</section>

<style>
  .contact-video::-webkit-media-controls {
    display: none !important;
  }
  .contact-video::-webkit-media-controls-start-playback-button {
    display: none !important;
  }
  .contact-video::-webkit-media-controls-panel {
    display: none !important;
  }
</style>

<script>
  const video = document.getElementById("contact-video") as HTMLVideoElement;
  if (video) {
    video.play().catch(() => {});
  }
</script>
