---
import { property } from "../data/property";
import Menu from "@lucide/astro/icons/menu";
import X from "@lucide/astro/icons/x";

interface Props {
  transparent?: boolean;
}

const { transparent = false } = Astro.props;

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/#gallery", label: "Gallery" },
  { href: "/#amenities", label: "Amenities" },
  // { href: "/house-rules", label: "House Rules" },
  { href: "/#contact", label: "Contact" },
];

const currentPath = Astro.url.pathname;
---

<header
  id="header"
  class:list={[
    "fixed top-0 left-0 right-0 z-50 transition-all duration-300",
    transparent ? "bg-transparent" : "bg-white/95 backdrop-blur-sm shadow-sm",
  ]}
  data-transparent={transparent}
>
  <nav class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex h-16 items-center justify-between md:h-20">
      <!-- Logo -->
      <a
        href="/"
        class:list={[
          "text-lg font-semibold tracking-tight transition-colors md:text-xl",
          transparent ? "text-white" : "text-neutral-900",
        ]}
      >
        {property.name}
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden items-center gap-8 md:flex">
        {
          navLinks.map((link) => (
            <a
              href={link.href}
              class:list={[
                "text-sm font-medium transition-colors hover:text-primary-600",
                transparent
                  ? "text-white/90 hover:text-white"
                  : "text-neutral-600",
                currentPath === link.href && !transparent && "text-primary-600",
                link.label === "Contact" &&
                  "rounded-lg bg-primary-600 px-4 py-2 !text-white hover:bg-primary-700",
              ]}
            >
              {link.label}
            </a>
          ))
        }
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        type="button"
        class:list={[
          "relative z-60 inline-flex items-center justify-center rounded-lg p-2 md:hidden",
          transparent ? "text-white" : "text-neutral-700",
        ]}
        aria-expanded="false"
        aria-label="Toggle navigation menu"
      >
        <span id="menu-icon-open">
          <Menu class="h-6 w-6" />
        </span>
        <span id="menu-icon-close" class="hidden">
          <X class="h-6 w-6" />
        </span>
      </button>
    </div>
  </nav>
</header>

<!-- Full-screen Mobile Menu Overlay -->
<div
  id="mobile-menu"
  class="fixed inset-0 z-50 hidden flex-col bg-primary-600 md:hidden"
>
  <!-- Close Button -->
  <div class="flex h-16 items-center justify-between px-4">
    <a href="/" class="text-lg font-semibold tracking-tight text-white">
      {property.name}
    </a>
    <button
      id="mobile-menu-close"
      type="button"
      class="inline-flex items-center justify-center rounded-lg p-2 text-white"
      aria-label="Close menu"
    >
      <X class="h-6 w-6" />
    </button>
  </div>

  <!-- Navigation Links -->
  <nav class="flex flex-1 flex-col items-center justify-center gap-8">
    {
      navLinks.map((link) => (
        <a
          href={link.href}
          class:list={[
            "mobile-nav-link text-2xl font-medium text-white/90 transition-colors hover:text-white",
            link.label === "Contact" &&
              "mt-4 rounded-lg bg-white px-8 py-3 !text-primary-600 hover:bg-white/90",
          ]}
        >
          {link.label}
        </a>
      ))
    }
  </nav>
</div>

<script>
  const header = document.getElementById("header");
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenuClose = document.getElementById("mobile-menu-close");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuIconOpen = document.getElementById("menu-icon-open");
  const menuIconClose = document.getElementById("menu-icon-close");
  const mobileNavLinks = document.querySelectorAll(".mobile-nav-link");

  const openMenu = (): void => {
    mobileMenu?.classList.remove("hidden");
    mobileMenu?.classList.add("flex");
    menuIconOpen?.classList.add("hidden");
    menuIconClose?.classList.remove("hidden");
    mobileMenuButton?.setAttribute("aria-expanded", "true");
    document.body.style.overflow = "hidden";
  };

  const closeMenu = (): void => {
    mobileMenu?.classList.add("hidden");
    mobileMenu?.classList.remove("flex");
    menuIconOpen?.classList.remove("hidden");
    menuIconClose?.classList.add("hidden");
    mobileMenuButton?.setAttribute("aria-expanded", "false");
    document.body.style.overflow = "";
  };

  // Open menu
  mobileMenuButton?.addEventListener("click", () => {
    const isExpanded =
      mobileMenuButton.getAttribute("aria-expanded") === "true";
    if (isExpanded) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  // Close menu with X button
  mobileMenuClose?.addEventListener("click", closeMenu);

  // Close menu when clicking a link
  mobileNavLinks.forEach((link) => {
    link.addEventListener("click", closeMenu);
  });

  // Scroll-based header background (only for transparent headers)
  if (header?.dataset["transparent"] === "true") {
    const updateHeader = (): void => {
      if (window.scrollY > 50) {
        header.classList.remove("bg-transparent");
        header.classList.add("bg-white/95", "backdrop-blur-sm", "shadow-sm");
        header.querySelectorAll("a").forEach((link) => {
          if (!link.classList.contains("bg-primary-600")) {
            link.classList.remove("text-white", "text-white/90");
            link.classList.add("text-neutral-600", "text-neutral-900");
          }
        });
        mobileMenuButton?.classList.remove("text-white");
        mobileMenuButton?.classList.add("text-neutral-700");
      } else {
        header.classList.add("bg-transparent");
        header.classList.remove("bg-white/95", "backdrop-blur-sm", "shadow-sm");
        header.querySelectorAll("a").forEach((link) => {
          if (!link.classList.contains("bg-primary-600")) {
            link.classList.add("text-white", "text-white/90");
            link.classList.remove("text-neutral-600", "text-neutral-900");
          }
        });
        mobileMenuButton?.classList.add("text-white");
        mobileMenuButton?.classList.remove("text-neutral-700");
      }
    };

    window.addEventListener("scroll", updateHeader);
    updateHeader();
  }
</script>
