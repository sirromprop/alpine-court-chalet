---
import { property } from "../data/property";
import { cloudinaryVideo, cloudinaryUrl } from "../lib/cloudinary";
import HeroAnimated from "./HeroAnimated";

interface Props {
  videoId?: string;
  posterImageId?: string;
}

const { videoId = "hero-loop", posterImageId = property.images.heroFallback } =
  Astro.props;

const videoUrl = cloudinaryVideo(videoId, "q_auto");
const posterUrl = cloudinaryUrl(posterImageId, "w_1920,q_auto,f_auto");
---

<section class="relative h-screen w-full overflow-hidden">
  <!-- Poster Image Background (fallback for when video doesn't autoplay) -->
  <img
    src={posterUrl}
    alt=""
    aria-hidden="true"
    class="absolute inset-0 h-full w-full object-cover"
  />

  <!-- Video Background -->
  <video
    id="hero-video"
    autoplay
    muted
    loop
    playsinline
    disablepictureinpicture
    class="hero-video absolute inset-0 h-full w-full object-cover"
  >
    <source src={videoUrl} type="video/mp4" />
  </video>

  <!-- Gradient Overlay -->
  <div
    class="absolute inset-0 bg-gradient-to-b from-black/50 via-black/30 to-black/60"
  >
  </div>

  <!-- Animated Content -->
  <HeroAnimated
    client:load
    propertyName={property.name}
    featuredAmenities={property.featuredAmenities}
  />
</section>

<style>
  .hero-video::-webkit-media-controls {
    display: none !important;
  }
  .hero-video::-webkit-media-controls-start-playback-button {
    display: none !important;
  }
  .hero-video::-webkit-media-controls-panel {
    display: none !important;
  }
</style>

<script>
  const video = document.getElementById("hero-video") as HTMLVideoElement;
  if (video) {
    video.play().catch(() => {
      // Autoplay blocked - poster image shows as fallback
    });
  }
</script>
